CREATE DATABASE WeGreen;
USE WeGreen;

CREATE TABLE Tipo_Utilizadores (
    id INT AUTO_INCREMENT PRIMARY KEY,
    descricao VARCHAR(250) NOT NULL
);

INSERT INTO Tipo_Utilizadores (descricao) VALUES 
('Administrador'),
('Cliente'),
('Anunciante');


CREATE TABLE Planos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(200) NOT NULL,
    preco DECIMAL(10,2),
    limite_produtos INT,
    rastreio_tipo VARCHAR(200) NOT NULL,
    relatorio_pdf BOOLEAN DEFAULT FALSE
);

INSERT INTO Planos (nome, preco, limite_produtos, rastreio_tipo, relatorio_pdf) VALUES 
('Free', 0, 3, 'Basico', FALSE),
('Premium', 25, 10, 'Basico', TRUE),
('Enterprise', 100, NULL, 'Avancado', TRUE);


CREATE TABLE Ranking (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(250),
    pontos INT
);

INSERT INTO Ranking (nome, pontos) VALUES 
('Bronze', 0),
('Ouro', 50),
('Diamante', 150);


CREATE TABLE Utilizadores (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    nif VARCHAR(20),
    foto varchar(250),
    password VARCHAR(255) NOT NULL,
    tipo_utilizador_id INT,
    plano_id INT,
    ranking_id INT,
    pontos_conf INT DEFAULT 0,
    data_criacao DATE,
    FOREIGN KEY (ranking_id) REFERENCES Ranking(id),
    FOREIGN KEY (tipo_utilizador_id) REFERENCES Tipo_Utilizadores(id),
    FOREIGN KEY (plano_id) REFERENCES Planos(id)
);
INSERT INTO Utilizadores (nome, email, password, tipo_utilizador_id, plano_id, ranking_id, pontos_conf,foto)
VALUES 
('Admin WeGreen', 'admin@wegreen.pt', 'admin123', 1, 3, 3, 200,"src/img/pexels-beccacorreiaph-31095884.jpg"),
('João Silva', 'joao@wegreen.pt','cliente123', 2, 1, 1, 10,NULL),
('Maria Santos', 'maria@wegreen.pt','anunciante123', 3, 2, 2, 75,NULL);

INSERT INTO Utilizadores (nome, email, password, tipo_utilizador_id, plano_id, ranking_id, pontos_conf,foto)
VALUES 
('Maria Luiza3', 'Luiza3@wegreen.pt','anunciante123', 3, 3, 3, 0,NULL),
('Maria Luiza2', 'Luiza2@wegreen.pt','anunciante123', 3, 2, 3, 0,NULL),
('Maria Luiza', 'Luiza@wegreen.pt','anunciante123', 3, 1, 3, 0,NULL),
('Mango', 'mango@wegreen.pt', 'mango123', 2, 1, 1, 10,NULL);


CREATE TABLE Tipo_Produtos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    descricao VARCHAR(100) NOT NULL
);

INSERT INTO Tipo_Produtos (descricao) VALUES
('Roupa'),
('Calçado'),
('Acessórios'),
('Beleza'),
('Outros');


CREATE TABLE Produtos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(150) NOT NULL,
	descricão varchar(250),
    tipo_produto_id INT,
    preco DECIMAL(10,2) NOT NULL, #Preco que queres vender (Custas - Preco = Lucro)
	custo DECIMAL(10,2) NOT NULL, #Quanto custa o produto
    foto VARCHAR(255) NOT NULL,
    parceria varchar(250),
    tamanho varchar(250),
    anunciante_id INT,
    data_criacao DATE DEFAULT (CURDATE()),
    estado varchar(250) NOT NULL,
    FOREIGN KEY (tipo_produto_id) REFERENCES Tipo_Produtos(id),
    FOREIGN KEY (anunciante_id) REFERENCES Utilizadores(id)
);

INSERT INTO Produtos (nome, tipo_produto_id, preco, foto, anunciante_id)
VALUES 
('T-Shirt Orgânica', 1, 19.99, 'tshirt.jpg', 3),
('Tênis Sustentável', 2, 49.99, 'tenis.jpg', 3),
('Relógio de Bambu', 3, 89.99, 'relogio.jpg', 3);


CREATE TABLE Mensagens (
    id INT AUTO_INCREMENT PRIMARY KEY,
    remetente_id INT,
    destinatario_id INT,
    mensagem TEXT NOT NULL,
    seen BOOLEAN DEFAULT FALSE,
    edited BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (remetente_id) REFERENCES Utilizadores(id),
    FOREIGN KEY (destinatario_id) REFERENCES Utilizadores(id)
);

-- Mensagem exemplo
INSERT INTO Mensagens (remetente_id, destinatario_id, mensagem)
VALUES 
(3, 2, 'Olá João! O seu pedido já foi enviado.');


CREATE TABLE Rendimento (
    id INT AUTO_INCREMENT PRIMARY KEY,
    valor DECIMAL(10,2),
    anunciante_id int,
	descricao TEXT,
    data_registo TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (anunciante_id) REFERENCES Utilizadores(id)
);
INSERT INTO Rendimento (anunciante_id, valor,descricao)
VALUES 
(3, 25,"Premium comprado!"),
(4, 100,"Enterprize comprado!"),
(5, 25,"Premium comprado!"),
(null, 5,"Comissão cobrada!");


CREATE TABLE Gastos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    anunciante_id INT,
    valor DECIMAL(10,2),
    descricao TEXT,
    data_registo DATE DEFAULT (CURDATE()),
    FOREIGN KEY (anunciante_id) REFERENCES Utilizadores(id)
);

INSERT INTO Gastos (anunciante_id, valor, descricao)
VALUES (3, 50.00, 'Publicidade online');

CREATE TABLE Transportadora (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome ENUM('CTT', 'DPD') NOT NULL
);

INSERT INTO Transportadora (nome) VALUES 
('CTT'),
('DPD');

CREATE TABLE Encomendas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    codigo_encomenda VARCHAR(50) UNIQUE,
    cliente_id INT,
    anunciante_id INT,
    transportadora_id INT,
    data_envio DATE,
    estado VARCHAR(250),
    plano_rastreio VARCHAR(250),
    FOREIGN KEY (cliente_id) REFERENCES Utilizadores(id),
    FOREIGN KEY (anunciante_id) REFERENCES Utilizadores(id),
    FOREIGN KEY (transportadora_id) REFERENCES Transportadora(id)
);

INSERT INTO Encomendas (codigo_encomenda, cliente_id, anunciante_id, transportadora_id, data_envio, estado, plano_rastreio)
VALUES 
('WG12345', 2, 3, 1, CURDATE(), 'Em trânsito', 'Basico');

INSERT INTO Encomendas (codigo_encomenda, cliente_id, anunciante_id, transportadora_id, data_envio, estado, plano_rastreio)
VALUES 
('WG12346', 2, 3, 1, CURDATE(), 'Entregue', 'Basico'),
('WG12347', 7, 3, 2, CURDATE(), 'Em trânsito', 'Basico'),
('WG12352', 2, 3, 1, CURDATE(), 'Em trânsito', 'Basico'),
('WG12353', 7, 3, 1, CURDATE(), 'Entregue', 'Basico'),
('WG12348', 2, 4, 1, CURDATE(), 'Entregue', 'Avancado'),
('WG12349', 7, 4, 2, CURDATE(), 'Pendente', 'Avancado'),
('WG12354', 2, 4, 2, CURDATE(), 'Entregue', 'Avancado'),
('WG12350', 2, 5, 1, CURDATE(), 'Entregue', 'Basico'),
('WG12351', 7, 5, 2, CURDATE(), 'Cancelada', 'Basico'),
('WG12355', 7, 5, 1, CURDATE(), 'Pendente', 'Basico');


CREATE TABLE Denuncias (
    id INT AUTO_INCREMENT PRIMARY KEY,
    denunciante_id INT,
    denunciado_id INT,
    descricao TEXT,
    imagem_anexo VARCHAR(255),
    estado VARCHAR(250) DEFAULT 'Pendente',
    data_registo DATE DEFAULT (CURDATE()),
    FOREIGN KEY (denunciante_id) REFERENCES Utilizadores(id),
    FOREIGN KEY (denunciado_id) REFERENCES Utilizadores(id)
);


CREATE TABLE Historico_Produtos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    encomenda_id INT,
    estado_encomenda VARCHAR(250) DEFAULT 'Pendente',
    descricao TEXT,
    data_atualizacao DATE DEFAULT (CURDATE()),
    FOREIGN KEY (encomenda_id) REFERENCES Encomendas(id)
);
INSERT INTO Historico_Produtos (encomenda_id, estado_encomenda, descricao)
VALUES 
(2, 'Entregue', 'Produto entregue ao cliente.'),
(3, 'Em trânsito', 'Produto enviado pela transportadora.'),
(4, 'Entregue', 'Entrega concluída.'),
(5, 'Pendente', 'Aguardando envio.'),
(6, 'Entregue', 'Venda finalizada com sucesso.'),
(7, 'Cancelada', 'Encomenda cancelada pelo cliente.'),
(8, 'Em trânsito', 'Produto saiu do armazém.'),
(9, 'Entregue', 'Cliente recebeu o produto.'),
(10, 'Entregue', 'Envio concluído.'),
(11, 'Pendente', 'Aguardando confirmação de pagamento.');

CREATE TABLE Vendas (
    id INT AUTO_INCREMENT PRIMARY KEY,
    encomenda_id INT,
    anunciante_id INT NOT NULL,
    produto_id INT NULL,
    quantidade INT DEFAULT 1,
    valor DECIMAL(10,2),
    lucro DECIMAL(10,2),
    data_venda DATE DEFAULT (CURDATE()),
    FOREIGN KEY (encomenda_id) REFERENCES Encomendas(id),
    FOREIGN KEY (anunciante_id) REFERENCES Utilizadores(id),
    FOREIGN KEY (produto_id) REFERENCES Produtos(id)
);
INSERT INTO Vendas (encomenda_id, anunciante_id, produto_id, quantidade, valor, lucro)
VALUES
(1, 3, 1, 2, 39.98, 2.40),
(2, 3, 3, 1, 89.99, 5.40),  
(3, 3, 2, 1, 49.99, 3.00),  
(4, 4, 3, 3, 269.97, 16.20), 
(5, 4, 2, 1, 49.99, 3.00); 

CREATE TABLE Planos_Ativos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    anunciante_id INT NOT NULL,
    plano_id INT NOT NULL,
    data_inicio DATE DEFAULT (CURDATE()),
    data_fim DATE,
    ativo BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (anunciante_id) REFERENCES Utilizadores(id),
    FOREIGN KEY (plano_id) REFERENCES Planos(id)
);

INSERT INTO Planos_Ativos (anunciante_id, plano_id, data_inicio, ativo)
VALUES (3, 2, CURDATE(), TRUE);
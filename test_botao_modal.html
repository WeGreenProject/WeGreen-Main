<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Teste BotÃ£o Modal</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      body {
        font-family: Arial;
        padding: 40px;
      }
      button {
        padding: 15px 30px;
        font-size: 16px;
        background: #22c55e;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background: #16a34a;
      }
      #detalhesModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9999;
      }
      #detalhesModal > div {
        position: relative;
        width: 90%;
        max-width: 800px;
        margin: 50px auto;
        background: white;
        border-radius: 10px;
        padding: 20px;
      }
      .close-btn {
        float: right;
        background: #dc3545;
        padding: 5px 15px;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª Teste: BotÃ£o â†’ Modal â†’ Mapa</h1>

    <p>
      Se este teste funcionar, o problema estÃ¡ em minhasEncomendas.php (cache ou
      conflito JavaScript)
    </p>

    <button onclick="testeVerDetalhes()">ğŸ‘ï¸ Ver Detalhes (Teste)</button>

    <div id="detalhesModal">
      <div>
        <button class="close-btn" onclick="fecharModal()">âœ• Fechar</button>
        <div id="detalhesContent"></div>
      </div>
    </div>

    <script>
      console.log("âœ… Script carregado");

      function testeVerDetalhes() {
        console.log("ğŸš€ testeVerDetalhes() chamado");

        // Simular dados da encomenda
        const encomenda = {
          codigo_encomenda: "WG12345",
          data_envio: "06/12/2025",
          estado: "pendente",
          transportadora: "CTT",
          tipo_entrega: "domicilio",
          morada: "Rua das Flores 15, Lisboa",
          morada_completa: "Rua das Flores 15, 1200-001 Lisboa",
          total: "39.98",
        };

        mostrarDetalhes(encomenda);
      }

      function mostrarDetalhes(encomenda) {
        console.log("ğŸ” mostrarDetalhes() chamado:", encomenda);

        const tipoEntrega = encomenda.tipo_entrega || "domicilio";
        const tituloMorada =
          tipoEntrega === "ponto_recolha"
            ? "ğŸ“ Ponto de Recolha"
            : "ğŸ  Morada de Entrega";
        const moradaCompleta =
          tipoEntrega === "ponto_recolha"
            ? encomenda.morada_ponto_recolha || encomenda.morada
            : encomenda.morada_completa || encomenda.morada;

        console.log("ğŸ“ Tipo:", tipoEntrega);
        console.log("ğŸ  Morada:", moradaCompleta);

        const enderecoEncoded = encodeURIComponent(moradaCompleta);
        const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${enderecoEncoded}`;

        console.log("ğŸ—ºï¸ URL mapa:", googleMapsUrl);

        const mapaHtml = `
        <div style="margin-top: 15px; border-radius: 8px; overflow: hidden; border: 2px solid #22c55e;">
            <h4 style="margin: 0; padding: 10px; background: #f0fdf4;">ğŸ—ºï¸ Mapa da LocalizaÃ§Ã£o</h4>
            <iframe
                width="100%"
                height="400"
                frameborder="0"
                style="border:0"
                src="https://maps.google.com/maps?q=${enderecoEncoded}&t=&z=15&ie=UTF8&iwloc=&output=embed"
                allowfullscreen>
            </iframe>
            <div style="padding: 10px; background-color: #f3f4f6; text-align: center;">
                <a href="${googleMapsUrl}"
                   target="_blank"
                   style="color: #22c55e; text-decoration: none; font-weight: 600;">
                    ğŸ“ Abrir no Google Maps
                </a>
            </div>
        </div>
    `;

        const html = `
        <div style="padding: 20px;">
            <h2>Encomenda #${encomenda.codigo_encomenda}</h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div>
                    <h4 style="color: #22c55e;">InformaÃ§Ãµes da Encomenda</h4>
                    <p><strong>CÃ³digo:</strong> ${
                      encomenda.codigo_encomenda
                    }</p>
                    <p><strong>Data:</strong> ${encomenda.data_envio}</p>
                    <p><strong>Status:</strong> ${encomenda.estado}</p>
                    <p><strong>Transportadora:</strong> ${
                      encomenda.transportadora
                    }</p>
                </div>
                <div>
                    <h4 style="color: #22c55e;">${tituloMorada}</h4>
                    <p style="white-space: pre-line;">${moradaCompleta}</p>
                </div>
            </div>

            ${mapaHtml}

            <div style="margin-top: 20px; text-align: right;">
                <h3 style="color: #22c55e;">Total: â‚¬${parseFloat(
                  encomenda.total
                ).toFixed(2)}</h3>
            </div>
        </div>
    `;

        $("#detalhesContent").html(html);
        $("#detalhesModal").fadeIn();

        console.log("âœ… Modal aberto");
      }

      function fecharModal() {
        console.log("ğŸ”´ fecharModal() chamado");
        $("#detalhesModal").fadeOut();
      }
    </script>

    <hr style="margin: 40px 0" />

    <h2>InstruÃ§Ãµes:</h2>
    <ol>
      <li>Clique no botÃ£o verde "Ver Detalhes (Teste)"</li>
      <li>O modal deve abrir com o mapa do Google Maps</li>
      <li>Veja o Console (F12) para confirmar que os logs aparecem</li>
    </ol>

    <h3>Se funcionar aqui:</h3>
    <p>âœ… O cÃ³digo do mapa estÃ¡ correto</p>
    <p>
      âŒ O problema estÃ¡ em minhasEncomendas.php (cache do browser ou conflito)
    </p>

    <h3>SoluÃ§Ã£o:</h3>
    <ol>
      <li>Volte para minhasEncomendas.php</li>
      <li>
        Pressione <strong>CTRL + SHIFT + R</strong> (recarregar SEM cache)
      </li>
      <li>Ou limpe o cache do browser completamente</li>
    </ol>
  </body>
</html>

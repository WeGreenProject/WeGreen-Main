
<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registe-se - Puro Encanto</title>
<link rel="stylesheet" href="login.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>

</style>
</head>
<body>

<div class="auth-container">
    <div class="auth-background">
        <div class="gradient-overlay"></div>
        <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
        </div>
    </div>

    <div class="auth-card">
        <div class="auth-header">
            <div class="logo">
                <img src="images/logos/PURO ENCANTO LOGO.png" alt="Puro Encanto Logo">
            </div>
            <h1>Criar Conta</h1>
            <p>Junte-se a nós e torne os seus eventos inesquecíveis</p>
        </div>

        <form class="auth-form" id="registerForm">
            <div class="input-group">
                <div class="input-icon">
                    <i class="fas fa-user"></i>
                </div>
                <input type="text" id="username" placeholder="Nome completo" required>
                <label>Nome</label>
            </div>

            <div class="input-group">
                <div class="input-icon">
                    <i class="fas fa-envelope"></i>
                </div>
                <input type="email" id="email" placeholder="seu@email.com" required>
                <label>Email</label>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <div class="input-icon">
                        <i class="fas fa-id-card"></i>
                    </div>
                    <input type="text" id="nif" placeholder="123456789" required maxlength="9">
                    <label>NIF</label>
                </div>

                <div class="input-group">
                    <div class="input-icon">
                        <i class="fas fa-university"></i>
                    </div>
                    <input type="text" id="iban" placeholder="PT50..." required>
                    <label>IBAN</label>
                </div>
            </div>

            <div class="input-group">
                <div class="input-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <input type="password" id="password" placeholder="Mínimo 6 caracteres" required>
                <label>Password</label>
                <button type="button" class="toggle-password" onclick="togglePassword('password')">
                    <i class="fas fa-eye"></i>
                </button>
            </div>

            <div class="input-group">
                <div class="input-icon">
                    <i class="fas fa-user-tag"></i>
                </div>
                <select id="tpUser" required>
                    <option value="">Selecione o tipo de conta</option>
                </select>
                <label>Tipo de Utilizador</label>
            </div>

            <button type="button" id="btnRegister" class="btn-primary">
                <span>Criar Conta</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </form>

        <div class="auth-footer">
            <p>Já tem conta? <a href="login.php" class="link-primary">Inicie sessão</a></p>
        </div>
    </div>
</div>

<script>
function togglePassword(id) {
    const input = document.getElementById(id);
    const icon = event.currentTarget.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

$(document).ready(function(){

    $.getJSON('getTipos.php')
    .done(function(tipos){
        tipos.forEach(tipo => {
            $('#tpUser').append(`<option value="${tipo.ID_TipoUtilizador}">${tipo.Tipo}</option>`);
        });
    })
    .fail(function(){
        console.error('Erro ao carregar tipos de utilizador');
    });

    $('.auth-form input, .auth-form select').on('focus', function(){
        $(this).closest('.input-group').addClass('focused');
    }).on('blur', function(){
        if(!$(this).val()) {
            $(this).closest('.input-group').removeClass('focused');
        }
    });

    $('#btnRegister').on('click', function(){
        const btn = $(this);
        const nome = $('#username').val().trim();
        const email = $('#email').val().trim();
        const nif = $('#nif').val().trim();
        const iban = $('#iban').val().trim();
        const password = $('#password').val();
        const tipo = $('#tpUser').val();

        if(!nome || !email || !nif || !iban || !password || !tipo){
            Swal.fire({
                icon: 'error',
                title: 'Campos Obrigatórios',
                text: 'Por favor, preencha todos os campos!',
                confirmButtonColor: '#d1ae79',
                background: '#4b2e12',
                color: '#e6d7c3'
            });
            return;
        }


        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if(!emailRegex.test(email)){
            Swal.fire({
                icon: 'error',
                title: 'Email Inválido',
                text: 'Por favor, introduza um email válido!',
                confirmButtonColor: '#d1ae79',
                background: '#4b2e12',
                color: '#e6d7c3'
            });
            return;
        }

        if(nif.length !== 9 || !/^\d+$/.test(nif)){
            Swal.fire({
                icon: 'error',
                title: 'NIF Inválido',
                text: 'O NIF deve ter 9 dígitos!',
                confirmButtonColor: '#d1ae79',
                background: '#4b2e12',
                color: '#e6d7c3'
            });
            return;
        }

        if(password.length < 6){
            Swal.fire({
                icon: 'error',
                title: 'Password Fraca',
                text: 'A password deve ter no mínimo 6 caracteres!',
                confirmButtonColor: '#d1ae79',
                background: '#4b2e12',
                color: '#e6d7c3'
            });
            return;
        }

        btn.addClass('loading').prop('disabled', true);
        btn.find('span').text('A criar...');

        $.ajax({
            url: 'registar.php',
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            data: JSON.stringify({nome, email, nif, iban, password, tipo}),
            success: function(res){
                btn.removeClass('loading').prop('disabled', false);
                btn.find('span').text('Criar Conta');

                if(res.flag){
                    Swal.fire({
                        icon: 'success',
                        title: 'Conta Criada!',
                        text: res.msg,
                        confirmButtonColor: '#d1ae79',
                        background: '#4b2e12',
                        color: '#e6d7c3',
                        showConfirmButton: false,
                        timer: 2000
                    }).then(() => window.location.href = 'login.php');
                } else {
            
                }
            },
            
        });
    });

});
</script>

</body>
</html>

